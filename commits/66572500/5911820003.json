[{"filename": ".github/workflows/compare-artifacts.yml", "status": "modified", "additions": 46, "deletions": 12, "changes": 58, "file_content_changes": "@@ -12,7 +12,7 @@ jobs:\n     if: ${{ github.event.workflow_run.conclusion == 'success' }}\n \n     steps:\n-      - name: 'Download artifact'\n+      - name: Download PR number artifact\n         uses: actions/github-script@v6\n         with:\n           script: |\n@@ -32,20 +32,54 @@ jobs:\n             });\n             let fs = require('fs');\n             fs.writeFileSync(`${process.env.GITHUB_WORKSPACE}/pr_number.zip`, Buffer.from(download.data));\n-\n-      - name: 'Unzip artifact'\n-        run: unzip pr_number.zip\n-\n-      - name: 'Comment on PR'\n+      - name: Download comparison result artifact\n+        uses: actions/github-script@v6\n+        with:\n+          script: |\n+            let allArtifacts = await github.rest.actions.listWorkflowRunArtifacts({\n+               owner: context.repo.owner,\n+               repo: context.repo.repo,\n+               run_id: context.payload.workflow_run.id,\n+            });\n+            let matchArtifact = allArtifacts.data.artifacts.filter((artifact) => {\n+              return artifact.name == \"comparison_result\"\n+            })[0];\n+            let download = await github.rest.actions.downloadArtifact({\n+               owner: context.repo.owner,\n+               repo: context.repo.repo,\n+               artifact_id: matchArtifact.id,\n+               archive_format: 'zip',\n+            });\n+            let fs = require('fs');\n+            fs.writeFileSync(`${process.env.GITHUB_WORKSPACE}/comparison_result.zip`, Buffer.from(download.data));\n+      - name: Unzip artifacts\n+        run: |\n+          unzip pr_number.zip\n+          unzip comparison_result.zip\n+      - name: Print artifacts\n+        uses: actions/github-script@v6\n+        with:\n+          script: |\n+            let fs = require('fs');\n+            let pr_number = Number(fs.readFileSync('./pr_number'));\n+            let comparison_result = fs.readFileSync('./comparison_result', 'utf8');\n+            console.log(\"PR number = \", pr_number);\n+            console.log(\"Comparison result = \", comparison_result);\n+      - name: Comment on PR\n         uses: actions/github-script@v6\n         with:\n           github-token: ${{ secrets.GITHUB_TOKEN }}\n           script: |\n             let fs = require('fs');\n+            let run_id = context.payload.workflow_run.id;\n             let issue_number = Number(fs.readFileSync('./pr_number'));\n-            await github.rest.issues.createComment({\n-              owner: context.repo.owner,\n-              repo: context.repo.repo,\n-              issue_number: issue_number,\n-              body: `Ignore this message. This is to test another workflow posting comment on PR number ${issue_number}.`\n-            });\n+            let comparison_result = fs.readFileSync('./comparison_result', 'utf8');\n+            const message = `:warning: **This PR does not produce bitwise identical kernels as the branch it's merged against.** Please check artifacts for details. [Download the output file here](https://github.com/${{ github.repository }}/actions/runs/${run_id}).`;\n+            if (comparison_result.trim() !== 'SUCCESS') {\n+              await github.rest.issues.createComment({\n+                owner: context.repo.owner,\n+                repo: context.repo.repo,\n+                issue_number: issue_number,\n+                body: message\n+              });\n+            }"}, {"filename": ".github/workflows/integration-tests.yml", "status": "modified", "additions": 22, "deletions": 34, "changes": 56, "file_content_changes": "@@ -153,16 +153,6 @@ jobs:\n           sudo nvidia-smi -i 0 --lock-gpu-clocks=1280,1280\n           python3 -m pytest -vs . --reruns 10\n           sudo nvidia-smi -i 0 -rgc\n-      - name: Save PR number\n-        env:\n-          PR_NUMBER: ${{ github.event.number }}\n-        run: |\n-          mkdir -p ./pr\n-          echo $PR_NUMBER > ./pr/pr_number\n-      - uses: actions/upload-artifact@v3\n-        with:\n-          name: pr_number\n-          path: pr/\n \n   Integration-Tests-Third-Party:\n     needs: Runner-Preparation\n@@ -266,6 +256,17 @@ jobs:\n           sudo apt update\n           sudo apt install gh\n \n+      - name: Save PR number to a file\n+        env:\n+          PR_NUMBER: ${{ github.event.number }}\n+        run: |\n+          echo $PR_NUMBER > pr_number\n+      - name: Upload PR number to artifacts\n+        uses: actions/upload-artifact@v3\n+        with:\n+          name: pr_number\n+          path: pr_number\n+\n       - name: Download latest main artifacts\n         env:\n           ARTIFACT_NAME: artifacts A100\n@@ -361,33 +362,20 @@ jobs:\n             echo \"Error while comparing artifacts\"\n             echo \"COMPARISON_RESULT=error\" >> $GITHUB_ENV\n           fi\n-      - name: Check exit code and handle failure\n-        if: ${{ env.COMPARISON_RESULT == 'error' }}\n+      - name: Check comparison result and write to file\n         run: |\n-          echo \"Error while comparing artifacts\"\n-          exit 1\n-      - name: Fetch Run ID\n-        id: get_run_id\n-        run: echo \"RUN_ID=${{ github.run_id }}\" >> $GITHUB_ENV\n-\n+          if [ \"${{ env.COMPARISON_RESULT }}\" = \"true\" ]; then\n+            echo \"SUCCESS\" > comparison_result\n+          else\n+            echo \"FAILED\" > comparison_result\n+          fi\n+      - name: Upload comparison result to artifacts\n+        uses: actions/upload-artifact@v3\n+        with:\n+          name: comparison_result\n+          path: comparison_result\n       - name: Upload results as artifact\n         uses: actions/upload-artifact@v2\n         with:\n           name: kernels-reference-check\n           path: kernels_reference_check.txt\n-\n-      - name: Check output and comment on PR\n-        if: ${{ env.COMPARISON_RESULT == 'false' }}\n-        uses: actions/github-script@v5\n-        with:\n-          github-token: ${{ secrets.CI_ACCESS_TOKEN }}\n-          script: |\n-            const run_id = ${{ env.RUN_ID }};\n-            const issue_number = context.payload.pull_request.number;\n-            const message = `:warning: **This PR does not produce bitwise identical kernels as the branch it's merged against.** Please check artifacts for details. [Download the output file here](https://github.com/${{ github.repository }}/actions/runs/${run_id}).`;\n-            await github.rest.issues.createComment({\n-                owner: context.repo.owner,\n-                repo: context.repo.repo,\n-                issue_number: issue_number,\n-                body: message\n-            });"}]