[{"filename": "lib/Dialect/TritonGPU/Transforms/OptimizeDotOperands.cpp", "status": "modified", "additions": 6, "deletions": 4, "changes": 10, "file_content_changes": "@@ -94,12 +94,14 @@ class MoveOpAfterLayoutConversion : public mlir::RewritePattern {\n     int loadIdx = -1;\n     bool checkOp = false;\n     for (int i = 0; i < slice.size(); i++) {\n-      Operation *op = *(slice.begin() + i);\n-      if (isa<triton::LoadOp>(op))\n+      Operation *currOp = *(slice.begin() + i);\n+      if (currOp->getParentRegion() != op->getParentRegion())\n+        continue;\n+      if (isa<triton::LoadOp>(currOp))\n         checkOp = true;\n       else if (checkOp) {\n-        if (!isa<triton::FpToFpOp, triton::BitcastOp>(op) &&\n-            op->getDialect()->getTypeID() !=\n+        if (!isa<triton::FpToFpOp, triton::BitcastOp>(currOp) &&\n+            currOp->getDialect()->getTypeID() !=\n                 mlir::TypeID::get<arith::ArithDialect>())\n           return mlir::failure();\n       }"}]