[{"filename": "python/triton/runtime/jit.py", "status": "modified", "additions": 7, "deletions": 10, "changes": 17, "file_content_changes": "@@ -237,8 +237,8 @@ def __init__(self, module, name):\n         return JITFunction.cache_hook(key=key, repr=repr, fn=LegacyCompiler(module, name), compile={\"key\": key, **kwargs}, is_manual_warmup=False, already_compiled=False)\n \n     def _get_arg_specialization_key(self, arg) -> str:\n-        arg_annotation = self.__annotations__.get(arg, None)\n-        if arg_annotation is None:\n+        arg_annotation = self.__annotations__.get(arg, '')\n+        if arg_annotation == '':\n             return f'({arg}.data_ptr() % {JITFunction.divisibility} == 0) if hasattr({arg}, \"data_ptr\") \\\n                         else ({arg} % {JITFunction.divisibility} == 0, {arg} == 1) if isinstance({arg}, int) \\\n                         else (False,)'\n@@ -250,17 +250,15 @@ def _get_arg_specialization_key(self, arg) -> str:\n             return '(False,)'\n \n     def _get_arg_sig_key(self, arg) -> str:\n-        arg_annotation = self.__annotations__.get(arg, None)\n-        if arg_annotation is None:\n-            return f'_key_of({arg})'\n-        elif 'Tensor' in arg_annotation:\n+        arg_annotation = self.__annotations__.get(arg, '')\n+        if 'Tensor' in arg_annotation:\n             return f'{arg}.dtype'\n         elif arg_annotation == 'bool':\n             return \"i1\"\n         elif arg_annotation == 'float':\n             return 'fp32'\n         else:\n-            assert False\n+            return f'_key_of({arg})'\n \n     def _make_launcher(self):\n         regular_args = [f'{arg}' for i, arg in enumerate(self.arg_names) if i not in self.constexprs]\n@@ -360,10 +358,9 @@ def __init__(self, fn, version=None, do_not_specialize=None, debug=None):\n         self.debug = os.environ.get(\"TRITON_DEBUG\", \"0\") == \"1\" if debug is None else debug\n         # annotations\n         normalize_ty = lambda ty: ty.__name__ if isinstance(ty, type) else ty\n-        self.annotations = {self.arg_names.index(name): normalize_ty(ty) for name, ty in fn.__annotations__.items()}\n-        self.__annotations__ = fn.__annotations__\n+        self.__annotations__ = {name: normalize_ty(ty) for name, ty in fn.__annotations__.items()}\n         # index of constexprs\n-        self.constexprs = [index for index, ty in self.annotations.items() if 'constexpr' in ty]\n+        self.constexprs = [self.arg_names.index(name) for name, ty in self.__annotations__.items() if 'constexpr' in ty]\n         # launcher\n         self.run = self._make_launcher()\n         # re-use docs of wrapped function"}]