[{"filename": "python/triton/compiler/compiler.py", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "file_content_changes": "@@ -291,6 +291,8 @@ def make_hash(fn, **kwargs):\n     \"ptx\": ptx_arg_type_pattern,\n }\n \n+ttgir_num_warps_pattern = r'\"triton_gpu.num-warps\"\\s?=\\s?(\\d+)\\s?:'\n+\n \n def _get_jsonable_constants(constants):\n     def _is_jsonable(x):\n@@ -404,6 +406,11 @@ def compile(fn, **kwargs):\n         match = re.search(prototype_pattern[ir], src, re.MULTILINE)\n         name, signature = match.group(1), match.group(2)\n         types = re.findall(arg_type_pattern[ir], signature)\n+        if ir == 'ttgir':\n+            num_warps_matches = re.findall(ttgir_num_warps_pattern, src)\n+            assert len(num_warps_matches) == 1, \"Expected exactly one match for num_warps\"\n+            assert \"num_warps\" not in kwargs or int(num_warps_matches[0]) == num_warps, \"num_warps in ttgir does not match num_warps in compile\"\n+            num_warps = int(num_warps_matches[0])\n         param_tys = [convert_type_repr(ty) for ty in types]\n         signature = {k: v for k, v in enumerate(param_tys)}\n         first_stage = list(stages.keys()).index(ir)"}]