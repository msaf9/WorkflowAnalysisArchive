[{"filename": "lib/Dialect/TritonGPU/Transforms/Combine.cpp", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "file_content_changes": "@@ -609,9 +609,11 @@ class BlockedToMMA : public mlir::RewritePattern {\n     auto retShape = oldRetType.getShape();\n     auto mod = op->getParentOfType<mlir::ModuleOp>();\n     int numWarps = triton::gpu::TritonGPUDialect::getNumWarps(mod);\n-    auto newRetType = RankedTensorType::get(\n-        retShape, oldRetType.getElementType(),\n-        triton::gpu::MmaEncodingAttr::get(oldRetType.getContext(), 2, {2, 2}));\n+    auto newRetType =\n+        RankedTensorType::get(retShape, oldRetType.getElementType(),\n+                              triton::gpu::MmaEncodingAttr::get(\n+                                  oldRetType.getContext(), 2,\n+                                  getWarpsPerTile(retShape, 2, numWarps)));\n     // convert accumulator\n     auto oldAcc = dotOp.getOperand(2);\n     auto newAcc = rewriter.create<triton::gpu::ConvertLayoutOp>("}]