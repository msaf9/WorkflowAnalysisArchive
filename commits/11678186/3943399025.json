[{"filename": "CMakeLists.txt", "status": "modified", "additions": 32, "deletions": 31, "changes": 63, "file_content_changes": "@@ -188,8 +188,6 @@ add_subdirectory(include)\n add_subdirectory(lib)\n add_subdirectory(bin)\n \n-add_library(triton SHARED ${PYTHON_SRC})\n-\n # find_package(PythonLibs REQUIRED)\n \n set(TRITON_SOURCE_DIR \"${CMAKE_CURRENT_SOURCE_DIR}\")\n@@ -198,37 +196,40 @@ set(TRITON_BINARY_DIR \"${CMAKE_CURRENT_BINARY_DIR}\")\n get_property(dialect_libs GLOBAL PROPERTY MLIR_DIALECT_LIBS)\n get_property(conversion_libs GLOBAL PROPERTY MLIR_CONVERSION_LIBS)\n \n-target_link_libraries(triton\n-  TritonAnalysis\n-  TritonTransforms\n-  TritonGPUTransforms\n-  TritonLLVMIR\n-  TritonPTX\n-  ${dialect_libs}\n-  ${conversion_libs}\n-  # optimizations\n-  MLIRPass\n-  MLIRTransforms\n-  MLIRLLVMIR\n-  MLIRSupport\n-  MLIRTargetLLVMIRExport\n-  MLIRExecutionEngine\n-  MLIRMathToLLVM\n-  MLIRNVVMToLLVMIRTranslation\n-  MLIRIR\n-)\n-\n-target_link_options(triton PRIVATE ${LLVM_LDFLAGS})\n-\n-if(WIN32)\n-    target_link_libraries(triton PRIVATE ${LLVM_LIBRARIES} dl) # dl is from dlfcn-win32\n-elseif(APPLE)\n-    target_link_libraries(triton ${LLVM_LIBRARIES} z)\n-else()\n-    target_link_libraries(triton ${LLVM_LIBRARIES} z stdc++fs)\n+if(TRITON_BUILD_PYTHON_MODULE)\n+  add_library(triton SHARED ${PYTHON_SRC})\n+\n+  target_link_libraries(triton\n+    TritonAnalysis\n+    TritonTransforms\n+    TritonGPUTransforms\n+    TritonLLVMIR\n+    TritonPTX\n+    ${dialect_libs}\n+    ${conversion_libs}\n+    # optimizations\n+    MLIRPass\n+    MLIRTransforms\n+    MLIRLLVMIR\n+    MLIRSupport\n+    MLIRTargetLLVMIRExport\n+    MLIRExecutionEngine\n+    MLIRMathToLLVM\n+    MLIRNVVMToLLVMIRTranslation\n+    MLIRIR\n+  )\n+\n+  target_link_options(triton PRIVATE ${LLVM_LDFLAGS})\n+\n+  if(WIN32)\n+      target_link_libraries(triton PRIVATE ${LLVM_LIBRARIES} dl) # dl is from dlfcn-win32\n+  elseif(APPLE)\n+      target_link_libraries(triton ${LLVM_LIBRARIES} z)\n+  else()\n+      target_link_libraries(triton ${LLVM_LIBRARIES} z stdc++fs)\n+  endif()\n endif()\n \n-\n if(TRITON_BUILD_PYTHON_MODULE AND NOT WIN32)\n     set(CMAKE_SHARED_LIBRARY_SUFFIX \".so\")\n     # Check if the platform is MacOS"}, {"filename": "lib/Analysis/CMakeLists.txt", "status": "modified", "additions": 2, "deletions": 1, "changes": 3, "file_content_changes": "@@ -6,5 +6,6 @@ add_mlir_library(TritonAnalysis\n   Utility.cpp\n \n   DEPENDS\n+  TritonTableGen\n   TritonGPUAttrDefsIncGen\n-)\n\\ No newline at end of file\n+)"}]