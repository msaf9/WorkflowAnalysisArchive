[{"filename": "lib/Dialect/TritonGPU/Transforms/Pipeline.cpp", "status": "modified", "additions": 1, "deletions": 7, "changes": 8, "file_content_changes": "@@ -592,7 +592,6 @@ scf::ForOp LoopPipeliner::createNewForOp() {\n       nextIV.getLoc(), loopIterIdx,\n       builder.create<arith::ConstantIntOp>(nextIV.getLoc(), numStages, 32));\n \n-  SmallVector<Operation *> depLoads;\n   for (Operation *op : orderedDeps)\n     if (!loads.contains(op->getResult(0))) {\n       Operation *nextOp;\n@@ -605,8 +604,7 @@ scf::ForOp LoopPipeliner::createNewForOp() {\n             nextMapping.lookupOrDefault(loadOp.getPtr()), newMask,\n             nextMapping.lookupOrDefault(loadOp.getOther()), loadOp.getCache(),\n             loadOp.getEvict(), loadOp.getIsVolatile());\n-        loadOp.replaceAllUsesWith(nextOp->getResult(0));\n-        depLoads.push_back(op);\n+        nextMapping.map(loadOp.getResult(), nextOp->getResult(0));\n       } else {\n         nextOp = builder.clone(*op, nextMapping);\n       }\n@@ -626,10 +624,6 @@ scf::ForOp LoopPipeliner::createNewForOp() {\n       }\n     }\n \n-  // Take out the old dep loads\n-  for (auto *depLoad : depLoads)\n-    depLoad->erase();\n-\n   for (Operation *op : orderedDeps) {\n     Operation *nextOp = nullptr;\n     // Update loading mask"}]