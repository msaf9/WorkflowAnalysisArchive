[{"filename": "lib/Dialect/TritonGPU/Transforms/Combine.cpp", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "file_content_changes": "@@ -685,12 +685,7 @@ class RematerializeBackward : public mlir::RewritePattern {\n       if (processed.contains(currOperation)) {\n         Operation *newOperation =\n             cloneWithInferType(rewriter, currOperation, mapping);\n-        if(newOperation){\n-          if(mapping.contains(currOperand))\n-            newOperation->moveAfter(mapping.lookup(currOperand).getDefiningOp());\n-          else\n-            newOperation->moveAfter(currOperation);\n-        }\n+        newOperation->moveAfter(currOperation);\n         currOperation = newOperation;\n         currOperand = currOperation->getResult(0);\n       }\n@@ -702,6 +697,10 @@ class RematerializeBackward : public mlir::RewritePattern {\n           currOperand.getLoc(), newType, currOperand);\n       if (currOperation)\n         newOperand->moveAfter(currOperation);\n+      else{\n+        Block* block = currOperand.cast<BlockArgument>().getOwner();\n+        newOperand->moveAfter(block, block->begin());\n+      }\n       mapping.map(currOperand, newOperand);\n     }\n     rewriter.replaceOp(cvt, mapping.lookup(cvt->getOperand(0)));"}]