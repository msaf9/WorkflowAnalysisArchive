[{"filename": "lib/Conversion/TritonGPUToLLVM/ReduceOpToLLVM.cpp", "status": "modified", "additions": 5, "deletions": 3, "changes": 8, "file_content_changes": "@@ -425,10 +425,12 @@ struct ReduceOpConversion\n                 op.getResult()[i].getType().dyn_cast<RankedTensorType>()) {\n           auto resultLayout = resultTy.getEncoding().cast<SliceEncodingAttr>();\n           unsigned resultElems = getTotalElemsPerThread(resultTy);\n+          SmallVector<SmallVector<unsigned>> resultOffset =\n+              emitOffsetForLayout(resultLayout, resultTy);\n           SmallVector<Value> resultVals;\n-          for (auto it : accs) {\n-            auto key = it.first;\n-            key[axis] = 0;\n+          for (int j = 0; j < resultElems; j++) {\n+            auto key = resultOffset[j];\n+            key.insert(key.begin() + axis, 0);\n             resultVals.push_back(finalAccs[key][i]);\n           }\n           results[i] = getTypeConverter()->packLLElements(loc, resultVals,"}]