[{"filename": ".github/workflows/integration-tests.yml", "status": "modified", "additions": 28, "deletions": 25, "changes": 53, "file_content_changes": "@@ -189,8 +189,6 @@ jobs:\n           name: artifacts\n       - name: Unzip current job artifacts\n         run: |\n-          ls\n-          pwd\n           # Print the size of the downloaded artifact\n           echo \"Artifact size (stat): $(stat --printf=\"%s bytes\" artifacts.tar.gz)\"\n           echo \"Artifact size (du): $(du -sh artifacts.tar.gz)\"\n@@ -199,30 +197,35 @@ jobs:\n           mv cache current\n       - name: Compare artifacts\n         run: |\n-          pwd\n-          ls\n-          set +e\n-          python3 python/test/tools/compare_files.py --path1 reference --path2 current --kernels python/test/kernel_comparison/kernels.yml\n-          RESULT_CODE=$?\n-          set -e\n-          if [ $RESULT_CODE -ne 0 ]; then\n-            echo \"The Python script failed!\"\n-            echo \"ADD_COMMENT=true\" >> $GITHUB_ENV\n-          else\n-            echo \"The Python script passed!\"\n-          fi\n-      - name: Add comment on PR\n+          output=$(python3 python/test/tools/compare_files.py --path1 reference --path2 current --kernels python/test/kernel_comparison/kernels.yml)\n+          echo \"::set-output name=result::$output\"\n+\n+      - name: Fetch Run ID\n+        id: get_run_id\n+        run: echo \"::set-output name=run_id::${{ github.run_id }}\"\n+\n+      - name: Upload results as artifact\n+        uses: actions/upload-artifact@v2\n+        with:\n+          name: kernels-reference-check\n+          path: kernels_reference_check.txt\n+\n+      - name: Check output and comment on PR\n         if: ${{ env.ADD_COMMENT == 'true' }}\n         uses: actions/github-script@v5\n         with:\n           script: |\n-            const prComment = `\n-              :warning: **The Python script failed in the latest build!**\n-              Please review the logs and fix the issues.\n-            `;\n-            github.rest.issues.createComment({\n-              issue_number: context.payload.pull_request.number,\n-              owner: context.repo.owner,\n-              repo: context.repo.repo,\n-              body: prComment\n-            });\n+            const runId = ${{ steps.get_run_id.outputs.run_id }};\n+            const scriptOutput = ${{ steps.script_output.outputs.result }};\n+            if (scriptOutput === 'False') {\n+              const issue_number = context.payload.pull_request.number;\n+              const message = `:warning: this PR does not produce bitwise identical kernels as the branch it's merged against. Please check artifacts for details. [Download the output file here](https://github.com/${{ github.repository }}/actions/runs/${runId}/artifacts).`;\n+              await github.rest.issues.createComment({\n+                  owner: context.repo.owner,\n+                  repo: context.repo.repo,\n+                  issue_number: issue_number,\n+                  body: message\n+              });\n+            } else {\n+              echo \"No comment posted on the PR\"\n+            }"}]