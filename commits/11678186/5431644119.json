[{"filename": "python/src/triton.cc", "status": "modified", "additions": 11, "deletions": 9, "changes": 20, "file_content_changes": "@@ -1503,18 +1503,20 @@ void init_triton_ir(py::module &&m) {\n       .def(py::init<mlir::MLIRContext *>())\n       .def(\"enable_debug\",\n            [](mlir::PassManager &self) {\n+             if (!::triton::tools::getBoolEnv(\"MLIR_ENABLE_DUMP\"))\n+               return;\n+             self.getContext()->disableMultithreading();\n              auto printingFlags = mlir::OpPrintingFlags();\n              printingFlags.elideLargeElementsAttrs(16);\n+             auto print_always = [](mlir::Pass *, mlir::Operation *) {\n+               return true;\n+             };\n              self.enableIRPrinting(\n-                 /*shouldPrintBeforePass=*/nullptr,\n-                 /*shouldPrintAfterPass=*/\n-                 [](mlir::Pass *pass, mlir::Operation *) {\n-                   return ::triton::tools::getBoolEnv(\"MLIR_ENABLE_DUMP\");\n-                 },\n-                 /*printModuleScope=*/false,\n-                 /*printAfterOnlyOnChange=*/true,\n-                 /*printAfterOnlyOnFailure*/ false, llvm::dbgs(),\n-                 printingFlags);\n+                 /*shouldPrintBeforePass=*/print_always,\n+                 /*shouldPrintAfterPass=*/print_always,\n+                 /*printModuleScope=*/true,\n+                 /*printAfterOnlyOnChange=*/false,\n+                 /*printAfterOnlyOnFailure*/ true, llvm::dbgs(), printingFlags);\n            })\n       .def(\"run\",\n            [](mlir::PassManager &self, mlir::ModuleOp &mod) {"}]