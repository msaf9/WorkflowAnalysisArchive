[{"filename": "python/triton/compiler/make_launcher.py", "status": "modified", "additions": 5, "deletions": 6, "changes": 11, "file_content_changes": "@@ -208,11 +208,10 @@ def format_of(ty):\n \n       // raise exception asap\n       {\"; \".join([f\"DevicePtrInfo ptr_info{i} = getPointer(_arg{i}, {i}); if (!ptr_info{i}.valid) return NULL;\" if ty[0] == \"*\" else \"\" for i, ty in signature.items()])};\n+      Py_BEGIN_ALLOW_THREADS;\n       _launch(gridX, gridY, gridZ, num_warps, shared_memory, (hipStream_t)_stream, (hipFunction_t)_function{', ' + ', '.join(f\"ptr_info{i}.dev_ptr\" if ty[0]==\"*\" else f\"_arg{i}\" for i, ty in signature.items()) if len(signature) > 0 else ''});\n+      Py_END_ALLOW_THREADS;\n \n-      if (PyErr_Occurred()) {{\n-        return NULL;\n-      }}\n       if (launch_exit_hook != Py_None && !PyObject_CallObject(launch_exit_hook, args)) {{\n         return NULL;\n       }}\n@@ -366,6 +365,7 @@ def format_of(ty):\n     return ptr_info;\n   }}\n   PyErr_SetString(PyExc_TypeError, \"Pointer argument must be either uint64 or have data_ptr method\");\n+  ptr_info.valid = false;\n   return ptr_info;\n }}\n \n@@ -394,11 +394,10 @@ def format_of(ty):\n \n   // raise exception asap\n   {\"; \".join([f\"DevicePtrInfo ptr_info{i} = getPointer(_arg{i}, {i}); if (!ptr_info{i}.valid) return NULL;\" if ty[0] == \"*\" else \"\" for i, ty in signature.items()])};\n+  Py_BEGIN_ALLOW_THREADS;\n   _launch(gridX, gridY, gridZ, num_warps, num_ctas, clusterDimX, clusterDimY, clusterDimZ, shared_memory, (CUstream)_stream, (CUfunction)_function{', ' + ', '.join(f\"ptr_info{i}.dev_ptr\" if ty[0]==\"*\" else f\"_arg{i}\"for i, ty in signature.items()) if len(signature) > 0 else ''});\n+  Py_END_ALLOW_THREADS;\n \n- if (PyErr_Occurred()) {{\n-    return NULL;\n-  }}\n   if (launch_exit_hook != Py_None && !PyObject_CallObject(launch_exit_hook, args)) {{\n     return NULL;\n   }}"}]