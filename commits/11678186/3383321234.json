[{"filename": "lib/Dialect/TritonGPU/Transforms/Combine.cpp", "status": "modified", "additions": 8, "deletions": 7, "changes": 15, "file_content_changes": "@@ -541,6 +541,10 @@ class BlockedToMMA : public mlir::RewritePattern {\n     SmallVector<unsigned, 2> ret = {1, 1};\n     SmallVector<int64_t, 2> shapePerWarp = {16, 8};\n     bool changed = false;\n+    // TODO (@daadaada): double-check.\n+    // original logic in\n+    // https://github.com/openai/triton/blob/master/lib/codegen/analysis/layout.cc#L252\n+    // seems buggy for shape = [32, 16] ?\n     do {\n       changed = false;\n       if (ret[0] * ret[1] >= numWarps)\n@@ -549,15 +553,12 @@ class BlockedToMMA : public mlir::RewritePattern {\n           shape[1] / (shapePerWarp[1] * 2) / ret[1]) {\n         if (ret[0] < shape[0] / shapePerWarp[0]) {\n           ret[0] *= 2;\n-          changed = true;\n-        }\n-      } else {\n-        if (ret[1] < shape[1] / (shapePerWarp[1] * 2)) {\n+        } else\n           ret[1] *= 2;\n-          changed = true;\n-        }\n+      } else {\n+        ret[1] *= 2;\n       }\n-    } while (changed);\n+    } while (true);\n     return ret;\n   }\n "}]