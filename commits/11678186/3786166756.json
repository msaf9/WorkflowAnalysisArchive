[{"filename": "lib/Conversion/TritonGPUToLLVM/DotOpHelpers.h", "status": "modified", "additions": 10, "deletions": 4, "changes": 14, "file_content_changes": "@@ -205,6 +205,11 @@ struct DotOpMmaV1ConversionHelper {\n     }\n \n     Type f16x2Ty = vec_ty(f16_ty, 2);\n+    Type f16PtrTy = ptr_ty(f16_ty);\n+    if (tensorTy.getElementType().isBF16()) {\n+      f16x2Ty = vec_ty(i16_ty, 2);\n+      f16PtrTy = ptr_ty(i16_ty);\n+    }\n \n     // prepare arguments\n     SmallVector<Value> ptrA(numPtrA);\n@@ -213,8 +218,6 @@ struct DotOpMmaV1ConversionHelper {\n     for (int i = 0; i < numPtrA; i++)\n       ptrA[i] = gep(ptr_ty(f16_ty), smemBase, offA[i]);\n \n-    Type f16PtrTy = ptr_ty(f16_ty);\n-\n     auto ld = [&](decltype(has) &vals, int m, int k, Value val0, Value val1) {\n       vals[{m, k}] = {val0, val1};\n     };\n@@ -321,6 +324,10 @@ struct DotOpMmaV1ConversionHelper {\n \n     Type f16PtrTy = ptr_ty(f16_ty);\n     Type f16x2Ty = vec_ty(f16_ty, 2);\n+    if (tensorTy.getElementType().isBF16()) {\n+      f16PtrTy = ptr_ty(i16_ty);\n+      f16x2Ty = vec_ty(i16_ty, 2);\n+    }\n \n     SmallVector<Value> ptrB(numPtrB);\n     ValueTable hbs;\n@@ -369,8 +376,7 @@ struct DotOpMmaV1ConversionHelper {\n       elems.push_back(item.second.first);\n       elems.push_back(item.second.second);\n     }\n-    Type fp16x2Ty = vec_ty(type::f16Ty(ctx), 2);\n-    Type resTy = struct_ty(SmallVector<Type>(elems.size(), fp16x2Ty));\n+    Type resTy = struct_ty(SmallVector<Type>(elems.size(), f16x2Ty));\n     Value res = getStructFromElements(loc, elems, rewriter, resTy);\n     return res;\n   }"}]