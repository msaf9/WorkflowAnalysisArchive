[{"filename": "lib/Analysis/Utility.cpp", "status": "modified", "additions": 8, "deletions": 4, "changes": 12, "file_content_changes": "@@ -193,10 +193,14 @@ bool ScanLoweringHelper::isSupported() {\n \n unsigned ScanLoweringHelper::getScratchSizeInBytes() {\n   auto type = scanOp.getOperand(0).getType().cast<RankedTensorType>();\n-  unsigned tensorSizeInBytes =\n-      type.getNumElements() * type.getElementTypeBitWidth() / 8;\n-  return ceil<unsigned>(tensorSizeInBytes, (getAxisNumElementsPerThread() *\n-                                            getAxisNumThreadsPerWarp()));\n+  unsigned elementSizeInBytes = type.getElementTypeBitWidth() / 8;\n+  auto mod = scanOp->getParentOfType<ModuleOp>();\n+  unsigned numWarps = triton::gpu::TritonGPUDialect::getNumWarps(mod);\n+  unsigned numNonAxisElementsPerWapr =\n+      getNonAxisNumThreadsPerWarp() * getNonAxisNumElementsPerThread();\n+  unsigned numElements = numWarps * numNonAxisElementsPerWapr *\n+                         getAxisNumBlocks() * getNonAxisNumBlocks();\n+  return elementSizeInBytes * numElements;\n }\n \n triton::gpu::BlockedEncodingAttr ScanLoweringHelper::getEncoding() {"}]