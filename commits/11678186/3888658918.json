[{"filename": "python/triton/ops/blocksparse/softmax.py", "status": "modified", "additions": 1, "deletions": 2, "changes": 3, "file_content_changes": "@@ -115,9 +115,8 @@ def _blocksparse_softmax_bwd(\n     dout = tl.load(DOuts + lane_n, mask=mask, other=0.0)\n     dout = dout.to(tl.float32)\n     # compute\n+    a = tl.where((ns > m) & is_causal & (a==a), 0., a)\n     da = a * (dout - tl.sum(a * dout, 0))\n-    da = tl.where((ns > m) & is_causal, 0., da)\n-    da = tl.where(a != a, float(\"nan\"), da)\n     # apply relative attention\n     if DR is not None:\n         DR += z * stride_zr"}]