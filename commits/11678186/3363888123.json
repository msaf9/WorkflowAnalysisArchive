[{"filename": "lib/codegen/pass.cc", "status": "modified", "additions": 7, "deletions": 0, "changes": 7, "file_content_changes": "@@ -149,6 +149,13 @@ std::unique_ptr<llvm::Module> add_passes_to_emit_bin(\n   // ir.print(std::cout);\n   isel.visit(ir, *llvm);\n   shared_static = allocation.allocated_size();\n+  if (target->as_nvidia() && target->as_nvidia()->sm() < 70) {\n+    // sm < 70 (Pascal) has little shared memory resource.\n+    // Instead of having \"Error: Invalid argument\" on launching a kernel, let's throw an error here.\n+    if (shared_static >= 65536) {\n+      throw std::runtime_error(\"Device does not support shared memory of \" + std::to_string(shared_static) + \"bytes\");\n+    }\n+  }\n \n   if (isel.get_extern_lib_map().size() > 0) {\n     // If there's any extern lib calls,"}]