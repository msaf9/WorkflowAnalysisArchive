[{"filename": "python/triton/compiler.py", "status": "modified", "additions": 9, "deletions": 10, "changes": 19, "file_content_changes": "@@ -1079,7 +1079,6 @@ def format_of(ty):\n   CUDA_CHECK(cuLaunchKernel(function, gridX, gridY, gridZ, 32*{num_warps}, 1, 1, {name}_shmem, stream, params, 0));\n }}\n \n-\n CUdeviceptr getPointer(PyObject *obj, int idx) {{\n   if (PyLong_Check(obj)) {{\n     return (CUdeviceptr)PyLong_AsUnsignedLongLong(obj);\n@@ -1090,19 +1089,19 @@ def format_of(ty):\n   PyObject *ptr = PyObject_GetAttrString(obj, \"data_ptr\");\n   if(ptr){{\n     PyObject *empty_tuple = PyTuple_New(0);\n-    ptr = PyObject_Call(ptr, empty_tuple, NULL);\n+    PyObject *ret = PyObject_Call(ptr, empty_tuple, NULL);\n     Py_DECREF(empty_tuple);\n+    Py_DECREF(ptr);\n+    if (!PyLong_Check(ret)) {{\n+      PyErr_SetString(PyExc_TypeError, \"data_ptr method of Pointer object must return 64-bit int\");\n+    }}\n+    return (CUdeviceptr)PyLong_AsUnsignedLongLong(ret);\n   }}\n-  if (ptr == NULL) {{\n-    PyErr_SetString(PyExc_TypeError, \"Pointer argument must be either uint64 or have data_ptr method\");\n-  }}\n-  if (!PyLong_Check(ptr)) {{\n-    PyErr_SetString(PyExc_TypeError, \"data_ptr method of Pointer object must return 64-bit int\");\n-  }}\n-  return (CUdeviceptr)PyLong_AsUnsignedLongLong(ptr);\n-\n+  PyErr_SetString(PyExc_TypeError, \"Pointer argument must be either uint64 or have data_ptr method\");\n+  return (CUdeviceptr)0;\n }}\n \n+\n static PyObject* {kernel_name}(PyObject* self, PyObject* args) {{\n   int gridX, gridY, gridZ;\n   uint64_t stream;"}]