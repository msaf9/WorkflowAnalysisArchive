[{"filename": "lib/codegen/selection/generator.cc", "status": "modified", "additions": 8, "deletions": 5, "changes": 13, "file_content_changes": "@@ -65,18 +65,21 @@ Value* geper::operator()(Value *ptr, Value* off, const std::string& name){\n   if(auto* gep = dyn_cast<GetElementPtrInst>(ptr))\n   if(ConstantInt* cst1 = dyn_cast<ConstantInt>(gep->idx_begin()))\n   if(ConstantInt* cst2 = dyn_cast<ConstantInt>(off)){\n-    return (*builder_)->CreateGEP(gep->getPointerOperand(),\n-                                  (*builder_)->CreateAdd(cst1, cst2));\n+    return (*builder_)->CreateGEP(gep->getPointerOperand()->getType()->getScalarType()->getPointerElementType(),\n+                                  gep->getPointerOperand(), (*builder_)->CreateAdd(cst1, cst2));\n   }\n   // ptr + (off + cst) -> (ptr + off) + cst\n   if(auto* bin = dyn_cast<BinaryOperator>(off))\n   if(bin->getOpcode() == llvm::BinaryOperator::BinaryOps::Add)\n   if(ConstantInt* cst = dyn_cast<ConstantInt>(bin->getOperand(1))){\n-    return (*builder_)->CreateGEP((*builder_)->CreateGEP(ptr, bin->getOperand(0)),\n-                                  bin->getOperand(1));\n+    Value *gep = (*builder_)->CreateGEP(ptr->getType()->getScalarType()->getPointerElementType(),\n+                                        ptr, bin->getOperand(0));\n+    return (*builder_)->CreateGEP(gep->getType()->getScalarType()->getPointerElementType(),\n+                                  gep, bin->getOperand(1));\n   }\n   // default\n- return (*builder_)->CreateGEP(ptr, off, name);\n+  return (*builder_)->CreateGEP(ptr->getType()->getScalarType()->getPointerElementType(),\n+                                ptr, off, name);\n }\n \n //Value* geper::operator()(Type *ty, Value *ptr, std::vector<Value *> vals, const std::string &name) {"}]